
{{ $page_context := .Page }} <!-- not sure how this works, needed for the badges in the for loop... -->

<!-- print tables for each group of parameters -->

{{ range $parameter_set := .Params.scamp_parameters }}
	{{ $name := index $parameter_set "title"}}
	{{ $icon := index $parameter_set "icon" }}
	<h2 id="steps">{{ partial "shortcodes/icon.html" (dict "context" $page_context "icon" $icon) }} {{ $name }}</h2>
	<p>{{ index $parameter_set "description" }}</p>

	<!-- make a table of parameters -->
	<table class="scamp-parameters-summary-table">
		<tr>
			<th>Tag</th>
			<th>Description</th>
			<th>Type</th>
			<th>Provider</th>
		</tr>

		{{ range $info := sort $parameter_set.parameters "name" }}
			<tr>
				<td><code>{{ index $info "name" }}</code></td>
				<td>{{ index $info "description" | markdownify }}</td>
				<td><code>{{ index $info "type" }}</code></td>
				<td>
					{{ $args := dict "user"    (dict "colour" "orange" "icon" "user")
					                 "default" (dict "colour" "green" "icon" "dog")
					                 "process" (dict "colour" "blue" "icon" "cogs")}}

					{{ if $info.providers }}
						{{ range $provider := slice "user" "default" "process" }}
							{{ if $provider_value := index $info.providers $provider }}
								{{ $colour := index (index $args $provider) "colour" }}
								{{ $icon := index (index $args $provider) "icon" }}

								{{ $hover := $provider }}
								{{ if eq $provider "user" }}
									{{ $hover = printf "scamp-file parameter: %s" $provider_value }}
								{{ else if eq $provider "default" }}
									{{ $hover = printf "default value: %s" $provider_value }}
								{{ else if eq $provider "process" }}
									{{ $hover = printf "provided by upstream process: %s" $provider_value }}
								{{ end }}

								{{ $args := dict
									"context" $page_context
									"title" " "
									"style" $colour
									"content" (partial "shortcodes/icon.html" (dict "context" $page_context "icon" $icon))
									"hover" $hover }}

								{{ partial "shortcodes/badge.html" $args }}
							{{ end }}
						{{ end }}
					{{ else }}
						{{ partial "shortcodes/badge.html" (dict
							"context" $page_context
							"title" " "
							"style" "red"
							"content" "required"
							"hover" "Must be user-provided!") }}
					{{ end }}
				</td>
			</tr>
		{{ end }}
	</table>
{{ end }}
