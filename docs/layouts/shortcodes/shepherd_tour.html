<!-- collect named parameters, supplying defaults for missing parameters -->

{{ $tour := (default "tour" (.Get "tour")) }}
{{ $lang := (default "bash" (.Get "lang")) }}
{{ $anchor := (default (.Get "tour") (.Get "anchor")) }}
{{ $btn_msg := (default "Start the tour!" (.Get "btn_msg")) }}
{{ $icon := (default "bullhorn" (.Get "icon")) }}

{{ $steps_file := (path.Join .Page.File.Dir $tour "steps.json") }}

<!-- output the code chunk -->
{{ highlight ((path.Join .Page.File.Dir $tour "chunk") | readFile | safeHTML) $lang (printf "lineAnchors=%s" $anchor) }}

{{ if fileExists $steps_file }}
	<!-- get the javascript elements and replace placeholders -->
	{{ $steps_json := readFile $steps_file | replaceRE "line-" (printf "%s-" $tour) | safeJS }}
	{{ $shepherd := (printf "%s = make_default_tour(%s);" $tour $steps_json) | safeJS }}

	<!-- output the parsed javascript(s) -->
	<script type="text/javascript">{{ $shepherd }}</script>

	<!-- make a button to start the tour -->
	<p>{{ partial "shortcodes/button.html" (dict "context" .
	                                             "style" "primary"
	                                             "icon" $icon
	                                             "href" (printf "javascript:%s.start();" $tour)
	                                             "content" $btn_msg) }}</p>
{{ end }}